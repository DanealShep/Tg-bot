<html>
<head>
<title>main.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cc7832;}
.s1 { color: #a9b7c6;}
.s2 { color: #808080;}
.s3 { color: #6897bb;}
.s4 { color: #6a8759;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
main.py</font>
</center></td></tr></table>
<pre><span class="s0">import </span><span class="s1">PRICE</span>
<span class="s0">import </span><span class="s1">payments </span><span class="s0">as </span><span class="s1">payments</span>
<span class="s0">import </span><span class="s1">texts</span>
<span class="s0">from </span><span class="s1">aiogram.dispatcher.filters </span><span class="s0">import </span><span class="s1">IDFilter</span>
<span class="s0">from </span><span class="s1">telebot.apihelper </span><span class="s0">import </span><span class="s1">unban_chat_member</span>

<span class="s0">import </span><span class="s1">config  </span><span class="s2"># –¥–æ–±–∞–≤–∏—Ç—å —Ñ–∞–π–ª config</span>
<span class="s0">import </span><span class="s1">logging  </span><span class="s2"># –¥–æ–±–∞–≤–∏—Ç—å –º–æ–¥—É–ª—å logging</span>
<span class="s0">import </span><span class="s1">time</span>
<span class="s0">from </span><span class="s1">aiogram.utils </span><span class="s0">import </span><span class="s1">executor</span>
<span class="s0">import </span><span class="s1">sqlite3</span>
<span class="s0">from </span><span class="s1">aiogram </span><span class="s0">import </span><span class="s1">*</span>
<span class="s0">from </span><span class="s1">aiogram.types </span><span class="s0">import </span><span class="s1">*</span>
<span class="s0">from </span><span class="s1">aiogram.types </span><span class="s0">import </span><span class="s1">message</span>
<span class="s0">import </span><span class="s1">datetime</span>
<span class="s0">from </span><span class="s1">datetime </span><span class="s0">import </span><span class="s1">datetime</span><span class="s0">, </span><span class="s1">timedelta</span>
<span class="s0">import </span><span class="s1">asyncio</span>



<span class="s2">#aipgram , —Å–ø–∏—Å–æ–∫ . (aiogram.types) - —Å–µ—Ä–∞—è –ø–∞–ø–∫–∞</span>
<span class="s2">#(aiogram.types.user) - —Ñ–∞—É–ª –ø–∞–π—Ç–æ–Ω. –ú–æ–∂–Ω–æ –ø—Ä–æ–ø—É—Å–∫–∞—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ —Å–ø–∏—Å–∫–∞</span>
<span class="s2">#aiogram.types.callback_query</span>

<span class="s2"># log</span>
<span class="s1">logging.basicConfig(level=logging.INFO)</span>

<span class="s2"># init</span>
<span class="s1">bot = Bot(token=config.TOKEN)</span>
<span class="s1">dp = Dispatcher(bot)</span>
<span class="s1">wm = texts.welcometext</span>
<span class="s1">ht = texts.helptext</span>
<span class="s1">ut = texts.User_agreement</span>
<span class="s1">st = texts.status</span>

<span class="s2">#–±–∞–Ω –¥–ª—è –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</span>
<span class="s2">#–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—Ö–æ–¥–∏—Ç –≤ —á–∞—Ç (–µ–≥–æ –Ω–µ—Ç –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö)</span>
<span class="s2">#—Ö–µ–Ω–¥–ª–µ—Ä –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –∫–æ—Ç–æ—Ä—ã–π –∑–∞—à—ë–ª</span>
<span class="s2"># —Å–∫–∞–Ω–∏—Ä—É–µ—Ç –≤—Å–µ—Ö</span>
<span class="s2"># —Ç–µ, –∫—Ç–æ –∑–∞—à—ë–ª - –≤—ã—Ç–∞—Å–∫–∏–≤–∞–µ–º –∏—Ö id –∏ —Å–≤–µ—Ä—è–µ–º —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö</span>








<span class="s0">async def </span><span class="s1">kr():</span>
    <span class="s0">while True</span><span class="s1">:</span>
        <span class="s0">if </span><span class="s3">1 </span><span class="s1">== </span><span class="s3">1</span><span class="s1">:</span>
            <span class="s1">connect = sqlite3.connect(</span><span class="s4">&quot;Datas.db&quot;</span><span class="s1">)</span>
            <span class="s1">cursor = connect.cursor()</span>
            <span class="s1">dn = datetime.now()</span>
            <span class="s1">cursor.execute(</span><span class="s4">f&quot;SELECT ban_id FROM ban_users&quot;</span><span class="s1">)</span>
            <span class="s1">ban_db = cursor.fetchall()</span>
            <span class="s1">print(ban_db)</span>
            <span class="s0">for </span><span class="s1">a </span><span class="s0">in </span><span class="s1">ban_db:</span>
                    <span class="s1">print(a)</span>
                    <span class="s0">for </span><span class="s1">b </span><span class="s0">in </span><span class="s1">a:</span>
                        <span class="s1">print(b)</span>
                        <span class="s1">cursor.execute(</span>
                                <span class="s4">f&quot;SELECT tg_users_id, Subs_status, DATE_of_end_subs FROM users WHERE tg_users_id = </span><span class="s0">{</span><span class="s1">b</span><span class="s0">}</span><span class="s4">&quot;</span><span class="s1">)  </span><span class="s2"># –µ—Å–ª–∏ –∑–∞–±–∞–Ω–µ–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</span>
                        <span class="s1">main_db = cursor.fetchone()</span>
                        <span class="s1">print(main_db)</span>

                        <span class="s0">if not </span><span class="s1">(main_db </span><span class="s0">is None</span><span class="s1">):</span>
                            <span class="s0">if not </span><span class="s1">(main_db[</span><span class="s3">1</span><span class="s1">] </span><span class="s0">is None</span><span class="s1">):</span>
                                <span class="s0">if </span><span class="s1">main_db[</span><span class="s3">1</span><span class="s1">] == bool(</span><span class="s3">0</span><span class="s1">):</span>
                                    <span class="s1">print(</span><span class="s4">&quot;–∑–∞–±–∞–Ω–µ–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–æ—à—ë–ª –≤ –±–æ—Ç–∞&quot;</span><span class="s1">)</span>
                                    <span class="s0">if not </span><span class="s1">(datetime.strptime(main_db[</span><span class="s3">2</span><span class="s1">]</span><span class="s0">, </span><span class="s4">'%Y-%m-%d %H:%M:%S.%f'</span><span class="s1">)) </span><span class="s0">is None</span><span class="s1">:</span>
                                        <span class="s0">if </span><span class="s1">datetime.strptime(main_db[</span><span class="s3">2</span><span class="s1">]</span><span class="s0">, </span><span class="s4">'%Y-%m-%d %H:%M:%S.%f'</span><span class="s1">) &gt;= dn:</span>
                                            <span class="s1">print(</span><span class="s4">&quot;–∑.–ø –ø—Ä–∏–æ–±—Ä—ë–ª –ø–æ–¥–ø–∏—Å–∫—É –∏ –±—É–¥–µ—Ç —Ä–∞–∑–±–∞–Ω–µ–Ω&quot;</span><span class="s1">)</span>

            <span class="s1">connect.close()</span>


























<span class="s2"># –ë–ê–ù –í–û–®–ï–î–®–ò–• –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–ï–ô</span>
<span class="s1">@dp.message_handler(content_types=</span><span class="s4">&quot;new_chat_members&quot;</span><span class="s1">)</span>
<span class="s0">async def </span><span class="s1">join_chat_members(message: types.Message):</span>
    <span class="s1">connect = sqlite3.connect(</span><span class="s4">&quot;Datas.db&quot;</span><span class="s1">)</span>
    <span class="s1">cursor = connect.cursor()</span>
    <span class="s1">ucd = message.new_chat_members[</span><span class="s3">0</span><span class="s1">].id       </span><span class="s2">#user_chat_id = ucd</span>
    <span class="s1">print(ucd)</span>
    <span class="s1">cursor.execute(</span><span class="s4">f&quot;SELECT tg_users_id, Subs_status, DATE_of_end_subs FROM users WHERE tg_users_id = </span><span class="s0">{</span><span class="s1">ucd</span><span class="s0">}</span><span class="s4">&quot;</span><span class="s1">)</span>
    <span class="s1">stroka = cursor.fetchone()</span>
    <span class="s1">dn = datetime.now() </span><span class="s2">#dn datetime now</span>
    <span class="s0">if </span><span class="s1">stroka </span><span class="s0">is None</span><span class="s1">: </span><span class="s2"># –ï—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö(–∑–Ω–∞—á–∏—Ç –∫—Ç–æ-—Ç–æ —Å–∫–∏–Ω—É–ª –µ–º—É —Å—Å—ã–ª–∫—É)</span>
        <span class="s0">await </span><span class="s1">bot.ban_chat_member(chat_id=config.GROUP_ID</span><span class="s0">, </span><span class="s1">user_id=ucd)</span>
        <span class="s1">cursor.execute(</span><span class="s4">&quot;&quot;&quot;INSERT INTO ban_users(ban_id) VALUES (?)&quot;&quot;&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">f&quot;</span><span class="s0">{</span><span class="s1">ucd</span><span class="s0">}</span><span class="s4">&quot;</span><span class="s0">,</span><span class="s1">))</span>
        <span class="s1">print(</span><span class="s4">&quot;–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ—Ç. –û–Ω –±—É–¥–µ—Ç –∑–∞–±–∞–Ω–µ–Ω&quot;</span><span class="s1">)</span>
    <span class="s0">elif </span><span class="s1">stroka[</span><span class="s3">0</span><span class="s1">] == ucd </span><span class="s0">and </span><span class="s1">(datetime.strptime(stroka[</span><span class="s3">2</span><span class="s1">]</span><span class="s0">, </span><span class="s4">'%Y-%m-%d %H:%M:%S.%f'</span><span class="s1">) &lt;= dn </span><span class="s0">or </span><span class="s1">stroka[</span><span class="s3">2</span><span class="s1">] </span><span class="s0">is None</span><span class="s1">): </span><span class="s2">#–ï—Å–ª–∏ –æ–Ω –µ—Å—Ç—å –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö, –Ω–æ –Ω–µ—Ç –ø–æ–¥–ø–∏—Å–∫–∏ –∏–ª–∏ –æ–Ω–∞ –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–∞(–ø—Ä–æ—Å—Ç–æ –∑–∞—à—ë–ª –≤ –±–æ—Ç–∞ –∏ –ø–µ—Ä–µ—à—ë–ª –ø–æ —Å—Å—ã–ª–∫–µ)</span>
        <span class="s0">await </span><span class="s1">bot.ban_chat_member(chat_id=config.GROUP_ID</span><span class="s0">, </span><span class="s1">user_id=ucd)</span>
        <span class="s1">cursor.execute(</span><span class="s4">&quot;&quot;&quot;INSERT INTO ban_users(ban_id) VALUES (?)&quot;&quot;&quot;</span><span class="s0">, </span><span class="s1">(</span><span class="s4">f&quot;</span><span class="s0">{</span><span class="s1">ucd</span><span class="s0">}</span><span class="s4">&quot;</span><span class="s0">,</span><span class="s1">))</span>
        <span class="s1">print(</span><span class="s4">&quot;–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –µ—Å—Ç—å –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö. –£ –Ω–µ–≥–æ –Ω–µ—Ç –ø–æ–¥–ø–∏—Å–∫–∏ –∏–ª–∏ –æ–Ω–∞ –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–∞&quot;</span><span class="s1">)</span>

    <span class="s1">connect.commit()</span>
    <span class="s1">connect.close()</span>

<span class="s2"># –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø–æ –∏—Å—Ç–µ—á–µ–Ω–∏—é –ø–æ–¥–ø–∏—Å–∫–∏ –¥–ª—è —Ç–µ—Ö, –∫—Ç–æ –æ–ø–ª–∞—á–∏–≤–∞–ª –ø–æ–¥–ø–∏—Å–∫—É –∏ –µ—ë —Å—Ä–æ–∫ –∏—Å—Ç—ë–∫.</span>
<span class="s0">async def </span><span class="s1">kr1():</span>
    <span class="s0">while True</span><span class="s1">:</span>
        <span class="s0">if </span><span class="s3">1 </span><span class="s1">== </span><span class="s3">1</span><span class="s1">:</span>
            <span class="s1">connect = sqlite3.connect(</span><span class="s4">&quot;Datas.db&quot;</span><span class="s1">)</span>
            <span class="s1">cursor = connect.cursor()</span>
            <span class="s1">cursor.execute(</span><span class="s4">f&quot;SELECT tg_users_id, Subs_status, DATE_of_end_subs FROM users WHERE Subs_status = </span><span class="s0">{</span><span class="s1">bool(</span><span class="s3">1</span><span class="s1">)</span><span class="s0">}</span><span class="s4">&quot;</span><span class="s1">)</span>
            <span class="s1">old_db = cursor.fetchall()</span>
            <span class="s1">dm = datetime.now()</span>
            <span class="s1">print(old_db)</span>
            <span class="s0">for </span><span class="s1">c </span><span class="s0">in </span><span class="s1">old_db:                        </span><span class="s2"># –∏–∑ —Å—Ç—Ä–æ–∫ –º—ã –≤—ã–±–∏—Ä–∞–µ–º –≥–¥–µ –µ—Å—Ç—å –ø–æ–¥–ø–∏—Å–∫–∞ (1)</span>
                <span class="s1">print(c)</span>
                <span class="s1">print(c[</span><span class="s3">2</span><span class="s1">])</span>

                <span class="s0">if </span><span class="s1">datetime.strptime(c[</span><span class="s3">2</span><span class="s1">]</span><span class="s0">, </span><span class="s4">'%Y-%m-%d %H:%M:%S.%f'</span><span class="s1">) &lt;= dm :</span>
                    <span class="s1">cursor.execute(</span><span class="s4">f&quot;UPDATE users SET Subs_status = </span><span class="s0">{</span><span class="s1">bool(</span><span class="s3">0</span><span class="s1">)</span><span class="s0">} </span><span class="s4">WHERE Subs_status = </span><span class="s0">{</span><span class="s1">bool(</span><span class="s3">1</span><span class="s1">)</span><span class="s0">} </span><span class="s4">and DATE_of_end_subs =</span><span class="s0">{</span><span class="s1">datetime.strptime(c[</span><span class="s3">2</span><span class="s1">]</span><span class="s0">, </span><span class="s4">'%Y-%m-%d %H:%M:%S.%f'</span><span class="s1">)</span><span class="s0">}</span><span class="s4">&quot;</span><span class="s1">)</span>
                    <span class="s1">print(</span><span class="s4">&quot;—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∫–æ–Ω—á–∏–ª–∞—Å—å –ø–æ–¥–ø–∏—Å–∫–∞&quot;</span><span class="s1">)</span>

            <span class="s1">connect.commit()</span>
            <span class="s1">connect.close()</span>


<span class="s2">#–£—Å–ª–æ–≤–∏—è —Ä–∞–∑–±–∞–Ω–∞ –¥–ª—è —Å—Ç–∞—Ä—ã—Ö, —É –∫–æ–≥–æ –ø–æ–¥–ø–∏—Å–∫–∞ –∏—Å—Ç–µ–∫–ª–∞, –Ω–æ —Ä–µ—à–∏–ª–∏ –ø—Ä–æ–¥–ª–∏—Ç—å.</span>
<span class="s0">async def </span><span class="s1">kr2():</span>
    <span class="s0">while True</span><span class="s1">:</span>
        <span class="s0">if </span><span class="s3">1 </span><span class="s1">== </span><span class="s3">1</span><span class="s1">:</span>
            <span class="s1">connect = sqlite3.connect(</span><span class="s4">&quot;Datas.db&quot;</span><span class="s1">)</span>
            <span class="s1">cursor = connect.cursor()</span>

            <span class="s1">cursor.execute(</span><span class="s4">f&quot;SELECT tg_users_id, Subs_status, DATE_of_end_subs FROM users WHERE Subs_status = </span><span class="s0">{</span><span class="s1">bool(</span><span class="s3">1</span><span class="s1">)</span><span class="s0">}</span><span class="s4">&quot;</span><span class="s1">)</span>
            <span class="s1">old1_db = cursor.fetchall()</span>
            <span class="s1">dl = datetime.now()</span>
            <span class="s0">for </span><span class="s1">e </span><span class="s0">in </span><span class="s1">old1_db:</span>
                <span class="s0">if </span><span class="s1">datetime.strptime(e[</span><span class="s3">2</span><span class="s1">]</span><span class="s0">, </span><span class="s4">'%Y-%m-%d %H:%M:%S.%f'</span><span class="s1">) &gt;= dl:</span>
                    <span class="s1">print(</span><span class="s4">&quot;–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤ —á–∞—Ç–µ –ø—Ä–æ–¥–ª–∏–ª –ø–æ–¥–ø–∏—Å–∫—É - —Ä–∞–∑–±–∞–Ω–∏—Ç—å&quot;</span><span class="s1">)</span>

            <span class="s1">connect.close()</span>


















<span class="s2"># –ú–µ–Ω—é</span>
<span class="s1">@dp.message_handler(commands=[</span><span class="s4">'start'</span><span class="s1">])</span>
<span class="s0">async def </span><span class="s1">cmd_handler(message: types.Message):</span>
    <span class="s0">if not </span><span class="s1">message.chat.type == </span><span class="s4">'private' </span><span class="s1">:</span>

        <span class="s0">pass</span>
        <span class="s0">await </span><span class="s1">message.bot.delete_message(chat_id=config.GROUP_ID</span><span class="s0">, </span><span class="s1">message_id=message.message_id) </span><span class="s2">#—É–¥–∞–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π –±–æ—Ç–∞ –∏–∑ –≥—Ä—É–ø–ø–æ–≤–æ–≥–æ —á–∞—Ç–∞</span>

    <span class="s0">else</span><span class="s1">:</span>

        <span class="s0">await </span><span class="s1">message.answer(</span>
            <span class="s4">&quot;–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤—É–µ–º —Ç–µ–±—è, {0.first_name} !üëã&quot;</span><span class="s1">.format(message.from_user</span><span class="s0">, </span><span class="s1">bot.get_me())</span><span class="s0">,</span>
            <span class="s1">parse_mode=</span><span class="s4">'html'</span><span class="s1">)</span>
        <span class="s1">time.sleep(</span><span class="s3">2.0</span><span class="s1">)</span>





       <span class="s2"># base data</span>
        <span class="s1">connect = sqlite3.connect(</span><span class="s4">&quot;Datas.db&quot;</span><span class="s1">)</span>
        <span class="s1">cursor = connect.cursor()</span>


        <span class="s1">user_id = message.from_user.id</span>
        <span class="s1">user_name = message.from_user.username</span>
        <span class="s1">user_firstname = message.from_user.first_name</span>

        <span class="s1">cursor.execute(</span><span class="s4">f&quot;SELECT tg_users_id FROM users WHERE tg_users_id=</span><span class="s0">{</span><span class="s1">user_id</span><span class="s0">}</span><span class="s4">&quot;</span><span class="s1">)</span>
        <span class="s1">data = cursor.fetchone()</span>
        <span class="s0">if </span><span class="s1">data </span><span class="s0">is None</span><span class="s1">:</span>
            <span class="s1">user_id = message.from_user.id</span>
            <span class="s1">user_name = message.from_user.username</span>
            <span class="s1">user_firstname = message.from_user.first_name</span>

            <span class="s1">cursor.execute(</span><span class="s4">&quot;&quot;&quot;INSERT INTO users  
            (tg_users_id, users_name, users_firstname) 
            VALUES (?, ?, ?)&quot;&quot;&quot;</span><span class="s0">,</span><span class="s1">(</span><span class="s4">f&quot;</span><span class="s0">{</span><span class="s1">user_id</span><span class="s0">}</span><span class="s4">&quot;</span><span class="s0">, </span><span class="s4">&quot;@&quot; </span><span class="s1">+ </span><span class="s4">f&quot;</span><span class="s0">{</span><span class="s1">user_name</span><span class="s0">}</span><span class="s4">&quot;</span><span class="s0">, </span><span class="s4">f&quot;</span><span class="s0">{</span><span class="s1">user_firstname</span><span class="s0">}</span><span class="s4">&quot;</span><span class="s1">)) </span><span class="s2"># ? - –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä—ã. –ü—Ä–æ—Å—Ç–æ –∑–∞–Ω–∏–º–∞—é—Ç –º–µ—Å—Ç–æ, –∞ –≤ –Ω–∏—Ö –ª–µ—Ç—è—Ç —Ñ—É–Ω–∫—Ü–∏–∏ f' #—Å—Ç–æ–ª–±—Ü—ã —Ç–∞–±–ª–∏—Ü—ã</span>

        <span class="s0">else</span><span class="s1">:</span>
            <span class="s1">user_id = message.from_user.id</span>
            <span class="s1">user_name = message.from_user.username</span>
            <span class="s1">user_firstname = message.from_user.first_name</span>
            <span class="s1">cursor.execute(</span><span class="s4">f&quot;&quot;&quot;UPDATE users SET users_name = '</span><span class="s0">{</span><span class="s4">&quot;@&quot;</span><span class="s1">+user_name</span><span class="s0">}</span><span class="s4">', users_firstname = '</span><span class="s0">{</span><span class="s1">user_firstname</span><span class="s0">}</span><span class="s4">'</span>
            <span class="s4">WHERE tg_users_id = '</span><span class="s0">{</span><span class="s1">user_id</span><span class="s0">}</span><span class="s4">' AND (users_name &lt;&gt; '</span><span class="s0">{</span><span class="s4">&quot;@&quot;</span><span class="s1">+user_name</span><span class="s0">}</span><span class="s4">' </span>
            <span class="s4">OR users_firstname &lt;&gt; '</span><span class="s0">{</span><span class="s1">user_firstname</span><span class="s0">}</span><span class="s4">') &quot;&quot;&quot;</span><span class="s1">)</span>


        <span class="s1">connect.commit()</span>
        <span class="s1">connect.close()</span>



        <span class="s1">markup = types.InlineKeyboardMarkup(row_width=</span><span class="s3">1</span><span class="s1">)</span>
        <span class="s1">item = types.InlineKeyboardButton(</span><span class="s4">'–¢–µ—Ö.–ø–æ–¥–¥–µ—Ä–∂–∫–∞ üôã'</span><span class="s0">, </span><span class="s1">callback_data=</span><span class="s4">'help'</span><span class="s1">)</span>
        <span class="s1">item2 = types.InlineKeyboardButton(</span><span class="s4">&quot;–û–ø–ª–∞—Ç–∞ üí≥&quot;</span><span class="s0">, </span><span class="s1">callback_data=</span><span class="s4">'buymenu'</span><span class="s1">)</span>
        <span class="s1">item3 = types.InlineKeyboardButton(</span><span class="s4">&quot;–£—Å–ª–æ–≤–∏—è –ø–æ–¥–ø–∏—Å–∫–∏ üìë&quot;</span><span class="s0">, </span><span class="s1">callback_data=</span><span class="s4">&quot;subscription info&quot;</span><span class="s1">)</span>
        <span class="s1">itemm = types.InlineKeyboardButton(</span><span class="s4">&quot;–°—Ç–∞—Ç—É—Å –ø–æ–¥–ø–∏—Å–∫–∏&quot;</span><span class="s0">, </span><span class="s1">callback_data=</span><span class="s4">'status'</span><span class="s1">)</span>
        <span class="s1">markup.add(item2</span><span class="s0">, </span><span class="s1">item3</span><span class="s0">, </span><span class="s1">item</span><span class="s0">, </span><span class="s1">itemm)</span>
        <span class="s0">await </span><span class="s1">message.answer( wm</span><span class="s0">, </span><span class="s1">reply_markup=markup)  </span><span class="s2"># wm –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç</span>


<span class="s1">@dp.callback_query_handler(</span><span class="s0">lambda </span><span class="s1">call: </span><span class="s0">True</span><span class="s1">)</span>
<span class="s0">async def </span><span class="s1">answe(call: CallbackQuery):</span>
    <span class="s2"># –¢–µ—Ö.–ø–æ–¥–¥–µ—Ä–∂–∫–∞</span>
    <span class="s0">if </span><span class="s1">call.data == </span><span class="s4">'help'</span><span class="s1">:</span>
        <span class="s1">markupmenuT = types.InlineKeyboardMarkup(resize_keyboard=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">FAQT = types.KeyboardButton(</span><span class="s4">&quot;FAQ ‚ùì&quot;</span><span class="s0">, </span><span class="s1">callback_data=</span><span class="s4">&quot;FAQ&quot;</span><span class="s1">)</span>
        <span class="s1">helpT = types.KeyboardButton(</span><span class="s4">&quot;–ü–æ–¥–¥–µ—Ä–∂–∫–∞ üéß&quot;</span><span class="s0">, </span><span class="s1">callback_data=</span><span class="s4">&quot;writeadmin&quot;</span><span class="s1">)</span>
        <span class="s1">bkT = types.KeyboardButton(</span><span class="s4">'‚¨Ö'</span><span class="s0">, </span><span class="s1">callback_data=</span><span class="s4">'backt1'</span><span class="s1">)</span>
        <span class="s1">markupmenuT.add(FAQT</span><span class="s0">, </span><span class="s1">helpT</span><span class="s0">, </span><span class="s1">bkT)</span>
        <span class="s0">await </span><span class="s1">call.message.answer(ht</span><span class="s0">, </span><span class="s1">reply_markup=markupmenuT)</span>
    <span class="s0">elif </span><span class="s1">call.data == </span><span class="s4">'backt1'</span><span class="s1">:</span>
        <span class="s0">await </span><span class="s1">call.message.delete()</span>

        <span class="s2"># –£—Å–ª–æ–≤–∏—è –ø–æ–¥–ø–∏—Å–∫–∏</span>
    <span class="s0">if </span><span class="s1">call.data == </span><span class="s4">'subscription info'</span><span class="s1">:</span>
        <span class="s1">markupmenuS = types.InlineKeyboardMarkup(resize_keyboard=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">bks = types.KeyboardButton(</span><span class="s4">'‚¨Ö'</span><span class="s0">, </span><span class="s1">callback_data=</span><span class="s4">'backt1'</span><span class="s1">)</span>
        <span class="s1">markupmenuS.add(bks)</span>
        <span class="s0">await </span><span class="s1">call.message.answer(</span>
                                  <span class="s1">ut</span><span class="s0">,</span>
                                  <span class="s1">reply_markup=markupmenuS)</span>
    <span class="s0">elif </span><span class="s1">call.data == </span><span class="s4">'backt1'</span><span class="s1">:</span>
        <span class="s0">await </span><span class="s1">call.message.delete()</span>


        <span class="s2"># –°—Ç–∞—Ç—É—Å –ø–æ–¥–ø–∏—Å–∫–∏</span>
    <span class="s0">if </span><span class="s1">call.data == </span><span class="s4">'status'</span><span class="s1">:</span>
        <span class="s1">markupmenuC = types.InlineKeyboardMarkup(resize_keyboard=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">bkC = types.KeyboardButton(</span><span class="s4">'‚¨Ö'</span><span class="s0">, </span><span class="s1">callback_data=</span><span class="s4">'backC'</span><span class="s1">)</span>
        <span class="s1">markupmenuC.add(bkC)</span>

        <span class="s1">connect = sqlite3.connect(</span><span class="s4">&quot;Datas.db&quot;</span><span class="s1">)</span>
        <span class="s1">cursor = connect.cursor()</span>

        <span class="s1">cursor.execute(</span><span class="s4">&quot;SELECT * FROM users&quot;</span><span class="s1">)</span>
        <span class="s0">for </span><span class="s1">person </span><span class="s0">in </span><span class="s1">cursor.fetchall():</span>
            <span class="s1">print(</span><span class="s4">f&quot;</span><span class="s0">{</span><span class="s1">person[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">} </span><span class="s4">- </span><span class="s0">{</span><span class="s1">person[</span><span class="s3">1</span><span class="s1">]</span><span class="s0">}</span><span class="s4">&quot;</span><span class="s1">)</span>

        <span class="s1">connect.commit()</span>
        <span class="s1">connect.close()</span>


        <span class="s0">await </span><span class="s1">call.message.answer(</span><span class="s4">&quot;–ö–ª–∏–µ–Ω—Ç {0.first_name}&quot;</span><span class="s1">.format(call.from_user</span><span class="s0">, </span><span class="s1">bot.get_me()) + st</span><span class="s0">, </span><span class="s1">parse_mode=</span><span class="s4">'html'</span><span class="s0">, </span><span class="s1">reply_markup=markupmenuC)</span>
    <span class="s0">elif </span><span class="s1">call.data == </span><span class="s4">'backC'</span><span class="s1">:</span>
        <span class="s0">await </span><span class="s1">call.message.delete()</span>

        <span class="s2"># –ü–æ–∫—É–ø–Ω–æ–µ –º–µ–Ω—é (–æ–ø–ª–∞—Ç–∞)</span>
    <span class="s0">if </span><span class="s1">call.data == </span><span class="s4">'buymenu'</span><span class="s1">:</span>
        <span class="s1">markupmenuw = types.InlineKeyboardMarkup(resize_keyboard=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">bt1 = types.KeyboardButton(</span><span class="s4">&quot; 1 –º–µ—Å—è—Ü &quot;</span><span class="s0">, </span><span class="s1">callback_data=</span><span class="s4">&quot;buytime1&quot;</span><span class="s1">)</span>
        <span class="s1">bt3 = types.KeyboardButton(</span><span class="s4">&quot; 3 –º–µ—Å—è—Ü–∞ &quot;</span><span class="s0">, </span><span class="s1">callback_data=</span><span class="s4">&quot;buytime3&quot;</span><span class="s1">)</span>
        <span class="s1">bt6 = types.KeyboardButton(</span><span class="s4">&quot; 6 –º–µ—Å—è—Ü–µ–≤ &quot;</span><span class="s0">, </span><span class="s1">callback_data=</span><span class="s4">&quot;buytime6&quot;</span><span class="s1">)</span>
        <span class="s1">bk = types.KeyboardButton(</span><span class="s4">'‚¨Ö'</span><span class="s0">, </span><span class="s1">callback_data=</span><span class="s4">'back'</span><span class="s1">)</span>
        <span class="s1">markupmenuw.add(bt1</span><span class="s0">, </span><span class="s1">bt3</span><span class="s0">, </span><span class="s1">bt6</span><span class="s0">, </span><span class="s1">bk)</span>
        <span class="s0">await </span><span class="s1">call.message.answer(</span><span class="s4">&quot;–í—ã–±–µ—Ä–∏—Ç–µ –≤—Ä–µ–º—è –¥–µ–π—Å—Ç–≤–∏—è –ø–æ–¥–ø–∏—Å–∫–∏&quot;</span><span class="s0">, </span><span class="s1">reply_markup=markupmenuw)</span>
    <span class="s0">elif </span><span class="s1">call.data == </span><span class="s4">'back'</span><span class="s1">:</span>
        <span class="s0">await </span><span class="s1">call.message.delete()</span>

        <span class="s2"># 1 –º–µ—Å—è—Ü –ø–æ–¥–ø–∏—Å–∫–∏</span>
    <span class="s0">if </span><span class="s1">call.data == </span><span class="s4">'buytime1'</span><span class="s1">:</span>
        <span class="s1">markupmenu1 = types.InlineKeyboardMarkup(resize_keyboard=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">rub = types.KeyboardButton(</span><span class="s4">&quot;–†—É–±–ª–∏&quot;</span><span class="s0">, </span><span class="s1">callback_data=</span><span class="s4">&quot;rub1&quot;</span><span class="s1">)</span>
        <span class="s1">eur = types.KeyboardButton(</span><span class="s4">&quot;–ï–≤—Ä–æ&quot;</span><span class="s0">, </span><span class="s1">callback_data=</span><span class="s4">&quot;eur1&quot;</span><span class="s1">)</span>
        <span class="s1">bk = types.KeyboardButton(</span><span class="s4">'‚¨Ö'</span><span class="s0">, </span><span class="s1">callback_data=</span><span class="s4">'back1'</span><span class="s1">)</span>
        <span class="s1">markupmenu1.add(rub</span><span class="s0">, </span><span class="s1">eur</span><span class="s0">, </span><span class="s1">bk)</span>
        <span class="s0">await </span><span class="s1">call.message.answer(</span><span class="s4">&quot;–í—ã –≤—ã–±—Ä–∞–ª–∏ –ü–æ–¥–ø–∏—Å–∫—É –Ω–∞ 1 –º–µ—Å—è—Ü. –¢–µ–ø–µ—Ä—å –≤—ã–±–µ—Ä–∏—Ç–µ –≤–∞–ª—é—Ç—É –¥–ª—è –æ–ø–ª–∞—Ç—ã –ø–æ–¥–ø–∏—Å–∫–∏&quot;</span><span class="s0">,</span>
                                  <span class="s1">reply_markup=markupmenu1)</span>
    <span class="s0">elif </span><span class="s1">call.data == </span><span class="s4">'back1'</span><span class="s1">:</span>
        <span class="s0">await </span><span class="s1">call.message.delete()</span>

        <span class="s2"># 3 –º–µ—Å—è—Ü–∞ –ø–æ–¥–ø–∏—Å–∫–∏</span>
    <span class="s0">elif </span><span class="s1">call.data == </span><span class="s4">'buytime3'</span><span class="s1">:</span>
        <span class="s1">markupmenu1 = types.InlineKeyboardMarkup(resize_keyboard=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">rub = types.KeyboardButton(</span><span class="s4">&quot;–†—É–±–ª–∏&quot;</span><span class="s0">, </span><span class="s1">callback_data=</span><span class="s4">&quot;rub3&quot;</span><span class="s1">)</span>
        <span class="s1">eur = types.KeyboardButton(</span><span class="s4">&quot;–ï–≤—Ä–æ&quot;</span><span class="s0">, </span><span class="s1">callback_data=</span><span class="s4">&quot;eur3&quot;</span><span class="s1">)</span>
        <span class="s1">bk = types.KeyboardButton(</span><span class="s4">'‚¨Ö'</span><span class="s0">, </span><span class="s1">callback_data=</span><span class="s4">'back1'</span><span class="s1">)</span>
        <span class="s1">markupmenu1.add(rub</span><span class="s0">, </span><span class="s1">eur</span><span class="s0">, </span><span class="s1">bk)</span>
        <span class="s0">await </span><span class="s1">call.message.answer(</span>
            <span class="s4">&quot;–í—ã –≤—ã–±—Ä–∞–ª–∏ –ü–æ–¥–ø–∏—Å–∫—É –Ω–∞ 3 –º–µ—Å—è—Ü–∞. –¢–µ–ø–µ—Ä—å –≤—ã–±–µ—Ä–∏—Ç–µ –≤–∞–ª—é—Ç—É –¥–ª—è –æ–ø–ª–∞—Ç—ã –ø–æ–¥–ø–∏—Å–∫–∏&quot;</span><span class="s0">,</span>
            <span class="s1">reply_markup=markupmenu1)</span>
    <span class="s0">elif </span><span class="s1">call.data == </span><span class="s4">'back1'</span><span class="s1">:</span>
        <span class="s0">await </span><span class="s1">call.message.delete()</span>

        <span class="s2"># 6 –º–µ—Å—è—Ü–µ–≤ –ø–æ–¥–ø–∏—Å–∫–∏</span>
    <span class="s0">elif </span><span class="s1">call.data == </span><span class="s4">'buytime6'</span><span class="s1">:</span>
        <span class="s1">markupmenu1 = types.InlineKeyboardMarkup(resize_keyboard=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">rub = types.KeyboardButton(</span><span class="s4">&quot;–†—É–±–ª–∏&quot;</span><span class="s0">, </span><span class="s1">callback_data=</span><span class="s4">&quot;rub6&quot;</span><span class="s1">)</span>
        <span class="s1">eur = types.KeyboardButton(</span><span class="s4">&quot;–ï–≤—Ä–æ&quot;</span><span class="s0">, </span><span class="s1">callback_data=</span><span class="s4">&quot;eur6&quot;</span><span class="s1">)</span>
        <span class="s1">bk = types.KeyboardButton(</span><span class="s4">'‚¨Ö'</span><span class="s0">, </span><span class="s1">callback_data=</span><span class="s4">'back1'</span><span class="s1">)</span>
        <span class="s1">markupmenu1.add(rub</span><span class="s0">, </span><span class="s1">eur</span><span class="s0">, </span><span class="s1">bk)</span>
        <span class="s0">await </span><span class="s1">call.message.answer(</span>
            <span class="s4">&quot;–í—ã –≤—ã–±—Ä–∞–ª–∏ –ü–æ–¥–ø–∏—Å–∫—É –Ω–∞ 6 –º–µ—Å—è—Ü–µ–≤. –¢–µ–ø–µ—Ä—å –≤—ã–±–µ—Ä–∏—Ç–µ –≤–∞–ª—é—Ç—É –¥–ª—è –æ–ø–ª–∞—Ç—ã –ø–æ–¥–ø–∏—Å–∫–∏&quot;</span><span class="s0">,</span>
            <span class="s1">reply_markup=markupmenu1)</span>
    <span class="s0">elif </span><span class="s1">call.data == </span><span class="s4">'back1'</span><span class="s1">:</span>
        <span class="s0">await </span><span class="s1">call.message.delete()</span>
        <span class="s2"># –æ–ø–ª–∞—Ç–∞ –ø–æ–¥–ø–∏—Å–∫–∏ 1 –º–µ—Å—è—Ü (—Ä—É–±)</span>
    <span class="s0">if </span><span class="s1">config.PAYMENTS_TOKEN.split(</span><span class="s4">':'</span><span class="s1">)[</span><span class="s3">1</span><span class="s1">] == </span><span class="s4">'TEST' </span><span class="s0">and </span><span class="s1">call.data == </span><span class="s4">'rub1'</span><span class="s1">:</span>
        <span class="s1">markupmenur1 = types.InlineKeyboardMarkup (resize_keyboard=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">bkr1 = types.KeyboardButton(</span><span class="s4">'‚¨Ö'</span><span class="s0">, </span><span class="s1">callback_data=</span><span class="s4">'backr1'</span><span class="s1">)</span>
        <span class="s1">Payr1 = types.KeyboardButton(</span><span class="s4">'–û–ø–ª–∞—Ç–∏—Ç—å'</span><span class="s0">, </span><span class="s1">pay=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">markupmenur1.add(Payr1</span><span class="s0">, </span><span class="s1">bkr1)</span>
        <span class="s1">amount = PRICE.PRICE1.amount</span>
        <span class="s0">await </span><span class="s1">bot.send_invoice(call.message.chat.id</span><span class="s0">,</span>
            <span class="s1">title=</span><span class="s4">&quot;–ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –ó–∞–∫—Ä—ã—Ç—É—é –≥—Ä—É–ø–ø—É&quot;</span><span class="s0">,</span>
            <span class="s1">description=</span><span class="s4">&quot;–ê–∫—Ç–∏–≤–∞—Ü–∏—è –ø–æ–¥–ø–∏—Å–∫–∏&quot;</span><span class="s0">,</span>
            <span class="s1">provider_token=config.PAYMENTS_TOKEN</span><span class="s0">,</span>
            <span class="s1">currency=</span><span class="s4">&quot;RUB&quot;</span><span class="s0">,</span>
            <span class="s1">photo_url=</span><span class="s4">&quot;https://sun9-37.userapi.com/impg/U91M8UnuxJv37TiSXJ19qh4gCkdZJp31WATrIg/UVGwNoMJXqQ.jpg?size=320x213&amp;quality=96&amp;sign=7cef1b549b14013701feebf2defde743&amp;c_uniq_tag=5VpH3wDgr1rU7z7g-_QJ4nXfFLgg-h37yz2rhdkB12M&amp;type=album&quot;</span>
                      <span class="s4">&quot;+&quot;</span><span class="s0">,</span>
            <span class="s1">photo_width=</span><span class="s3">320</span><span class="s0">,</span>
            <span class="s1">photo_height=</span><span class="s3">213</span><span class="s0">,</span>
            <span class="s1">photo_size=</span><span class="s3">320</span><span class="s0">,</span>
            <span class="s1">is_flexible=</span><span class="s0">False,</span>
            <span class="s1">prices=[LabeledPrice(label=</span><span class="s4">'–°—Ç–æ–∏–º–æ—Å—Ç—å –ø–æ–¥–ø–∏—Å–∫–∏'</span><span class="s0">, </span><span class="s1">amount=int(amount))]</span><span class="s0">,</span>
            <span class="s1">start_parameter=</span><span class="s4">&quot;unique-string&quot;</span><span class="s0">,</span>
            <span class="s1">payload=</span><span class="s4">&quot;test-invoice-payload&quot;</span><span class="s0">, </span><span class="s1">reply_markup=markupmenur1)</span>
        <span class="s0">await </span><span class="s1">call.message.answer(call.message.chat.id</span><span class="s0">, </span><span class="s4">&quot;–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞–∑–∞–¥&quot;</span><span class="s0">, </span><span class="s1">reply_markup=markupmenur1)</span>
    <span class="s0">elif </span><span class="s1">call.data == </span><span class="s4">'backr1'</span><span class="s1">:</span>
        <span class="s0">await </span><span class="s1">call.message.delete()</span>
        <span class="s2"># –æ–ø–ª–∞—Ç–∞ –ø–æ–¥–ø–∏—Å–∫–∏ 1 –º–µ—Å—è—Ü (–µ–≤—Ä–æ)</span>
    <span class="s0">if </span><span class="s1">(config.PAYMENTS_TOKEN.split(</span><span class="s4">':'</span><span class="s1">)[</span><span class="s3">1</span><span class="s1">] == </span><span class="s4">'TEST' </span><span class="s0">and </span><span class="s1">call.data == </span><span class="s4">'eur1'</span><span class="s1">):</span>
        <span class="s1">markupmenue1 = types.InlineKeyboardMarkup(resize_keyboard=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">bke1 = types.KeyboardButton(</span><span class="s4">'‚¨Ö'</span><span class="s0">, </span><span class="s1">callback_data=</span><span class="s4">'backe1'</span><span class="s1">)</span>
        <span class="s1">Paye1 = types.KeyboardButton(</span><span class="s4">'–û–ø–ª–∞—Ç–∏—Ç—å'</span><span class="s0">, </span><span class="s1">pay=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">markupmenue1.add(Paye1</span><span class="s0">, </span><span class="s1">bke1)</span>
        <span class="s1">amount = PRICE.PRICE2.amount</span>
        <span class="s0">await </span><span class="s1">bot.send_invoice(call.message.chat.id</span><span class="s0">, </span><span class="s1">title=</span><span class="s4">&quot;–ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –ó–∞–∫—Ä—ã—Ç—É—é –≥—Ä—É–ø–ø—É&quot;</span><span class="s0">,</span>
                               <span class="s1">description=</span><span class="s4">&quot;–ê–∫—Ç–∏–≤–∞—Ü–∏—è –ø–æ–¥–ø–∏—Å–∫–∏&quot;</span><span class="s0">,</span>
                               <span class="s1">provider_token=config.PAYMENTS_TOKEN</span><span class="s0">,</span>
                               <span class="s1">currency=</span><span class="s4">&quot;EUR&quot;</span><span class="s0">,</span>
                               <span class="s1">photo_url=</span><span class="s4">&quot;https://sun9-37.userapi.com/impg/U91M8UnuxJv37TiSXJ19qh4gCkdZJp31WATrIg/UVGwNoMJXqQ.jpg?size=320x213&amp;quality=96&amp;sign=7cef1b549b14013701feebf2defde743&amp;c_uniq_tag=5VpH3wDgr1rU7z7g-_QJ4nXfFLgg-h37yz2rhdkB12M&amp;type=album&quot;</span>
                                         <span class="s4">&quot;+&quot;</span><span class="s0">,</span>
                               <span class="s1">photo_width=</span><span class="s3">320</span><span class="s0">,</span>
                               <span class="s1">photo_height=</span><span class="s3">213</span><span class="s0">,</span>
                               <span class="s1">photo_size=</span><span class="s3">320</span><span class="s0">,</span>
                               <span class="s1">is_flexible=</span><span class="s0">False,</span>
                               <span class="s1">prices=[LabeledPrice(label=</span><span class="s4">'–°—Ç–æ–∏–º–æ—Å—Ç—å –ø–æ–¥–ø–∏—Å–∫–∏'</span><span class="s0">, </span><span class="s1">amount=int(amount))]</span><span class="s0">,</span>
                               <span class="s1">start_parameter=</span><span class="s4">&quot;unique-string&quot;</span><span class="s0">,</span>
                               <span class="s1">payload=</span><span class="s4">&quot;test-invoice-payload&quot;</span><span class="s0">, </span><span class="s1">reply_markup=markupmenue1)</span>
        <span class="s0">await </span><span class="s1">call.message.answer(</span><span class="s4">&quot;–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞–∑–∞–¥&quot;</span><span class="s0">, </span><span class="s1">reply_markup=markupmenue1)</span>
    <span class="s0">elif </span><span class="s1">call.data == </span><span class="s4">'backe1'</span><span class="s1">:</span>
        <span class="s0">await </span><span class="s1">call.message.delete()</span>

        <span class="s2"># –æ–ø–ª–∞—Ç–∞ –ø–æ–¥–ø–∏—Å–∫–∏ 3 –º–µ—Å—è—Ü (—Ä—É–±)</span>
    <span class="s0">if </span><span class="s1">(config.PAYMENTS_TOKEN.split(</span><span class="s4">':'</span><span class="s1">)[</span><span class="s3">1</span><span class="s1">] == </span><span class="s4">'TEST' </span><span class="s0">and </span><span class="s1">call.data == </span><span class="s4">'rub3'</span><span class="s1">):</span>
        <span class="s1">markupmenur3 = types.InlineKeyboardMarkup(resize_keyboard=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">bkr1 = types.KeyboardButton(</span><span class="s4">'‚¨Ö'</span><span class="s0">, </span><span class="s1">callback_data=</span><span class="s4">'backr1'</span><span class="s1">)</span>
        <span class="s1">Payr1 = types.KeyboardButton(</span><span class="s4">'–û–ø–ª–∞—Ç–∏—Ç—å'</span><span class="s0">, </span><span class="s1">pay=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">markupmenur3.add(Payr1</span><span class="s0">, </span><span class="s1">bkr1)</span>
        <span class="s1">amount = PRICE.PRICE3.amount</span>
        <span class="s0">await </span><span class="s1">bot.send_invoice(call.message.chat.id</span><span class="s0">,</span>
                               <span class="s1">title=</span><span class="s4">&quot;–ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –ó–∞–∫—Ä—ã—Ç—É—é –≥—Ä—É–ø–ø—É&quot;</span><span class="s0">,</span>
                               <span class="s1">description=</span><span class="s4">&quot;–ê–∫—Ç–∏–≤–∞—Ü–∏—è –ø–æ–¥–ø–∏—Å–∫–∏&quot;</span><span class="s0">,</span>
                               <span class="s1">provider_token=config.PAYMENTS_TOKEN</span><span class="s0">,</span>
                               <span class="s1">currency=</span><span class="s4">&quot;RUB&quot;</span><span class="s0">,</span>
                               <span class="s1">photo_url=</span><span class="s4">&quot;https://sun9-37.userapi.com/impg/U91M8UnuxJv37TiSXJ19qh4gCkdZJp31WATrIg/UVGwNoMJXqQ.jpg?size=320x213&amp;quality=96&amp;sign=7cef1b549b14013701feebf2defde743&amp;c_uniq_tag=5VpH3wDgr1rU7z7g-_QJ4nXfFLgg-h37yz2rhdkB12M&amp;type=album&quot;</span>
                                         <span class="s4">&quot;+&quot;</span><span class="s0">,</span>
                               <span class="s1">photo_width=</span><span class="s3">320</span><span class="s0">,</span>
                               <span class="s1">photo_height=</span><span class="s3">213</span><span class="s0">,</span>
                               <span class="s1">photo_size=</span><span class="s3">320</span><span class="s0">,</span>
                               <span class="s1">is_flexible=</span><span class="s0">False,</span>
                               <span class="s1">prices=[LabeledPrice(label=</span><span class="s4">'–°—Ç–æ–∏–º–æ—Å—Ç—å –ø–æ–¥–ø–∏—Å–∫–∏'</span><span class="s0">, </span><span class="s1">amount=int(amount))]</span><span class="s0">,</span>
                               <span class="s1">start_parameter=</span><span class="s4">&quot;unique-string&quot;</span><span class="s0">,</span>
                               <span class="s1">payload=</span><span class="s4">&quot;test-invoice-payload&quot;</span><span class="s0">, </span><span class="s1">reply_markup=markupmenur3)</span>
        <span class="s0">await </span><span class="s1">call.message.answer(</span><span class="s4">&quot;–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞–∑–∞–¥&quot;</span><span class="s0">, </span><span class="s1">reply_markup=markupmenur3)</span>
    <span class="s0">elif </span><span class="s1">call.data == </span><span class="s4">'backr1'</span><span class="s1">:</span>
        <span class="s0">await </span><span class="s1">call.message.delete()</span>
        <span class="s2"># –æ–ø–ª–∞—Ç–∞ –ø–æ–¥–ø–∏—Å–∫–∏ 6 –º–µ—Å—è—Ü–µ–≤ (—Ä—É–±)</span>
    <span class="s0">if </span><span class="s1">(config.PAYMENTS_TOKEN.split(</span><span class="s4">':'</span><span class="s1">)[</span><span class="s3">1</span><span class="s1">] == </span><span class="s4">'TEST' </span><span class="s0">and </span><span class="s1">call.data == </span><span class="s4">'rub6'</span><span class="s1">):</span>
        <span class="s1">markupmenur6 = types.InlineKeyboardMarkup(resize_keyboard=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">bkr1 = types.KeyboardButton(</span><span class="s4">'‚¨Ö'</span><span class="s0">, </span><span class="s1">callback_data=</span><span class="s4">'backr1'</span><span class="s1">)</span>
        <span class="s1">Payr1 = types.KeyboardButton(</span><span class="s4">'–û–ø–ª–∞—Ç–∏—Ç—å'</span><span class="s0">, </span><span class="s1">pay=</span><span class="s0">True</span><span class="s1">)</span>
        <span class="s1">markupmenur6.add(Payr1</span><span class="s0">, </span><span class="s1">bkr1)</span>
        <span class="s1">amount = PRICE.PRICE6.amount</span>
        <span class="s0">await </span><span class="s1">bot.send_invoice(call.message.chat.id</span><span class="s0">,</span>
                               <span class="s1">title=</span><span class="s4">&quot;–ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –ó–∞–∫—Ä—ã—Ç—É—é –≥—Ä—É–ø–ø—É&quot;</span><span class="s0">,</span>
                               <span class="s1">description=</span><span class="s4">&quot;–ê–∫—Ç–∏–≤–∞—Ü–∏—è –ø–æ–¥–ø–∏—Å–∫–∏&quot;</span><span class="s0">,</span>
                               <span class="s1">provider_token=config.PAYMENTS_TOKEN</span><span class="s0">,</span>
                               <span class="s1">currency=</span><span class="s4">&quot;RUB&quot;</span><span class="s0">,</span>
                               <span class="s1">photo_url=</span><span class="s4">&quot;https://sun9-37.userapi.com/impg/U91M8UnuxJv37TiSXJ19qh4gCkdZJp31WATrIg/UVGwNoMJXqQ.jpg?size=320x213&amp;quality=96&amp;sign=7cef1b549b14013701feebf2defde743&amp;c_uniq_tag=5VpH3wDgr1rU7z7g-_QJ4nXfFLgg-h37yz2rhdkB12M&amp;type=album&quot;</span>
                                         <span class="s4">&quot;+&quot;</span><span class="s0">,</span>
                               <span class="s1">photo_width=</span><span class="s3">320</span><span class="s0">,</span>
                               <span class="s1">photo_height=</span><span class="s3">213</span><span class="s0">,</span>
                               <span class="s1">photo_size=</span><span class="s3">320</span><span class="s0">,</span>
                               <span class="s1">is_flexible=</span><span class="s0">False,</span>
                               <span class="s1">prices=[LabeledPrice(label=</span><span class="s4">'–°—Ç–æ–∏–º–æ—Å—Ç—å –ø–æ–¥–ø–∏—Å–∫–∏'</span><span class="s0">, </span><span class="s1">amount=int(amount))]</span><span class="s0">,</span>
                               <span class="s1">start_parameter=</span><span class="s4">&quot;unique-string&quot;</span><span class="s0">,</span>
                               <span class="s1">payload=</span><span class="s4">&quot;test-invoice-payload&quot;</span><span class="s0">, </span><span class="s1">reply_markup=markupmenur6)</span>
        <span class="s0">await </span><span class="s1">call.message.answer(</span><span class="s4">&quot;–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞–∑–∞–¥&quot;</span><span class="s0">, </span><span class="s1">reply_markup=markupmenur6)</span>
    <span class="s0">elif </span><span class="s1">call.data == </span><span class="s4">'backr1'</span><span class="s1">:</span>
        <span class="s0">await </span><span class="s1">call.message.delete()</span>

        <span class="s2"># pre checout (must be answered in 10 seconds)</span>

<span class="s1">@dp.pre_checkout_query_handler(</span><span class="s0">lambda </span><span class="s1">query: </span><span class="s0">True</span><span class="s1">)</span>
<span class="s0">async def </span><span class="s1">pre_checkout_query(pre_checkout_q: types.PreCheckoutQuery):</span>
    <span class="s0">await </span><span class="s1">bot.answer_pre_checkout_query(pre_checkout_q.id</span><span class="s0">, </span><span class="s1">ok=</span><span class="s0">True</span><span class="s1">)</span>

    <span class="s2"># successful payment</span>
<span class="s1">@dp.message_handler(content_types=ContentType.SUCCESSFUL_PAYMENT)</span>
<span class="s0">async def </span><span class="s1">successful_payment(message: types.Message):</span>
    <span class="s1">print(</span><span class="s4">&quot;SUCCESSFUL PAYMENT:&quot;</span><span class="s1">)</span>
    <span class="s1">payment_info = message.successful_payment.to_python()</span>
    <span class="s0">for </span><span class="s1">k</span><span class="s0">, </span><span class="s1">v </span><span class="s0">in </span><span class="s1">payment_info.items():</span>
        <span class="s1">print(</span><span class="s4">f&quot;</span><span class="s0">{</span><span class="s1">k</span><span class="s0">}</span><span class="s4">=</span><span class="s0">{</span><span class="s1">v</span><span class="s0">}</span><span class="s4">&quot;</span><span class="s1">)</span>
    <span class="s0">await </span><span class="s1">message.answer(text=</span><span class="s4">f&quot;</span><span class="s0">{</span><span class="s1">k</span><span class="s0">}</span><span class="s4">=</span><span class="s0">{</span><span class="s1">v</span><span class="s0">}</span><span class="s4">&quot; </span><span class="s1">+ </span><span class="s4">'</span><span class="s0">\n </span><span class="s4">–≠—Ç–æ –Ω–æ–º–µ—Ä –≤–∞—à–µ–π –∫–≤–∏—Ç–∞–Ω—Ü–∏–∏!</span><span class="s0">\n </span><span class="s4">–°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —ç—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ üòâ'</span><span class="s1">)</span>
    <span class="s0">await </span><span class="s1">message.answer(</span><span class="s4">f&quot;–ü–ª–∞—Ç—ë–∂ –Ω–∞ —Å—É–º–º—É </span><span class="s0">{</span><span class="s1">message.successful_payment.total_amount // </span><span class="s3">100</span><span class="s0">} {</span><span class="s1">message.successful_payment.currency</span><span class="s0">} </span><span class="s4">–ø—Ä–æ—à—ë–ª —É—Å–ø–µ—à–Ω–æ!!!</span><span class="s0">\n </span><span class="s4">–í—ã –º–æ–∂–µ—Ç–µ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å —Å–≤–æ–µ–π –ø–æ–¥–ø–∏—Å–∫–∏ –≤ –∫–Ω–æ–ø–∫–µ –°—Ç–∞—Ç—É—Å –ø–æ–¥–ø–∏—Å–∫–∏ &quot;</span><span class="s1">)</span>
    <span class="s0">await </span><span class="s1">message.answer(</span><span class="s4">&quot;–≠—Ç–æ –≤–∞—à–∞ —Å—Å—ã–ª–∫–∞ –¥–ª—è –≤—Ö–æ–¥–∞ –≤ –∑–∞–∫—Ä—ã—Ç—É—é –≥—Ä—É–ø–ø—É üòä. –£–¥–∞—á–∏!&quot; </span><span class="s1">+ config.GROUP_URL)</span>
    <span class="s1">count = (message.successful_payment.total_amount // </span><span class="s3">100</span><span class="s1">)</span>
    <span class="s1">print(count)</span>




    <span class="s0">if </span><span class="s1">count == </span><span class="s3">100 </span><span class="s0">or </span><span class="s1">count == </span><span class="s3">1</span><span class="s1">:</span>
        <span class="s1">date1 = datetime.now()</span>
        <span class="s1">add1 = timedelta(days=</span><span class="s3">30</span><span class="s1">)</span>
        <span class="s1">date2 = date1 + add1</span>
        <span class="s1">print(date2)</span>
        <span class="s1">subs = </span><span class="s3">1</span>
        <span class="s1">subs_info = </span><span class="s4">f&quot;</span><span class="s0">{</span><span class="s1">k</span><span class="s0">}</span><span class="s4">=</span><span class="s0">{</span><span class="s1">v</span><span class="s0">}</span><span class="s4">&quot;</span>

        <span class="s1">connect = sqlite3.connect(</span><span class="s4">&quot;Datas.db&quot;</span><span class="s1">)</span>
        <span class="s1">cursor = connect.cursor()</span>

        <span class="s1">user_id = message.from_user.id</span>
        <span class="s1">user_name = message.from_user.username</span>
        <span class="s1">user_firstname = message.from_user.first_name</span>
        <span class="s1">cursor.execute(</span><span class="s4">&quot;&quot;&quot;INSERT OR IGNORE INTO users  
                (tg_users_id, users_name, users_firstname, money_rub, DATE_of_Pay, DATE_of_end_subs, Subs_status, SUBS_INFO)  
            VALUES (?, ?, ?, ?, ?, ?, ?, ?)&quot;&quot;&quot;</span><span class="s0">,</span>
                       <span class="s2"># ? - –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä—ã. –ü—Ä–æ—Å—Ç–æ –∑–∞–Ω–∏–º–∞—é—Ç –º–µ—Å—Ç–æ, –∞ –≤ –Ω–∏—Ö –ª–µ—Ç—è—Ç —Ñ—É–Ω–∫—Ü–∏–∏ f' #—Å—Ç–æ–ª–±—Ü—ã —Ç–∞–±–ª–∏—Ü—ã</span>
                       <span class="s1">(</span><span class="s4">f&quot;</span><span class="s0">{</span><span class="s1">user_id</span><span class="s0">}</span><span class="s4">&quot;</span><span class="s0">,</span><span class="s4">&quot;@&quot; </span><span class="s1">+ </span><span class="s4">f&quot;</span><span class="s0">{</span><span class="s1">user_name</span><span class="s0">}</span><span class="s4">&quot;</span><span class="s0">, </span><span class="s4">f&quot;</span><span class="s0">{</span><span class="s1">user_firstname</span><span class="s0">}</span><span class="s4">&quot;</span><span class="s0">, </span><span class="s4">f&quot;</span><span class="s0">{</span><span class="s1">count</span><span class="s0">}</span><span class="s4">&quot;</span><span class="s0">, </span><span class="s4">f&quot;</span><span class="s0">{</span><span class="s1">date1</span><span class="s0">}</span><span class="s4">&quot;</span><span class="s0">, </span><span class="s4">f&quot;</span><span class="s0">{</span><span class="s1">date2</span><span class="s0">}</span><span class="s4">&quot;</span><span class="s0">, </span><span class="s4">f&quot;</span><span class="s0">{</span><span class="s1">subs</span><span class="s0">}</span><span class="s4">&quot;</span><span class="s0">, </span><span class="s4">f&quot;</span><span class="s0">{</span><span class="s1">subs_info</span><span class="s0">}</span><span class="s4">&quot;</span><span class="s1">))</span>
        <span class="s1">cursor.execute(</span><span class="s4">&quot;&quot;&quot;REPLACE INTO users  
                (tg_users_id, users_name, users_firstname, money_rub, DATE_of_Pay, DATE_of_end_subs, Subs_status, SUBS_INFO)  
            VALUES (?, ?, ?, ?, ?, ?, ?, ?)&quot;&quot;&quot;</span><span class="s0">,</span>
                       <span class="s2"># ? - –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä—ã. –ü—Ä–æ—Å—Ç–æ –∑–∞–Ω–∏–º–∞—é—Ç –º–µ—Å—Ç–æ, –∞ –≤ –Ω–∏—Ö –ª–µ—Ç—è—Ç —Ñ—É–Ω–∫—Ü–∏–∏ f' #—Å—Ç–æ–ª–±—Ü—ã —Ç–∞–±–ª–∏—Ü—ã</span>
                       <span class="s1">(</span><span class="s4">f&quot;</span><span class="s0">{</span><span class="s1">user_id</span><span class="s0">}</span><span class="s4">&quot;</span><span class="s0">, </span><span class="s4">&quot;@&quot; </span><span class="s1">+ </span><span class="s4">f&quot;</span><span class="s0">{</span><span class="s1">user_name</span><span class="s0">}</span><span class="s4">&quot;</span><span class="s0">, </span><span class="s4">f&quot;</span><span class="s0">{</span><span class="s1">user_firstname</span><span class="s0">}</span><span class="s4">&quot;</span><span class="s0">, </span><span class="s4">f&quot;</span><span class="s0">{</span><span class="s1">count</span><span class="s0">}</span><span class="s4">&quot;</span><span class="s0">, </span><span class="s4">f&quot;</span><span class="s0">{</span><span class="s1">date1</span><span class="s0">}</span><span class="s4">&quot;</span><span class="s0">, </span><span class="s4">f&quot;</span><span class="s0">{</span><span class="s1">date2</span><span class="s0">}</span><span class="s4">&quot;</span><span class="s0">,  </span><span class="s4">f&quot;</span><span class="s0">{</span><span class="s1">subs</span><span class="s0">}</span><span class="s4">&quot;</span><span class="s0">, </span><span class="s4">f&quot;</span><span class="s0">{</span><span class="s1">subs_info</span><span class="s0">}</span><span class="s4">&quot;</span><span class="s1">))</span>
        <span class="s2"># –∏–º—è —Ñ—É–Ω–∫—Ü–∏–π, –∫–æ—Ç–æ—Ä—ã–µ –¥–∞—é—Ç —Å—é–¥–∞ –∑–Ω–∞—á–µ–Ω–∏—è</span>

        <span class="s1">connect.commit()</span>
        <span class="s1">connect.close()</span>



    <span class="s0">elif </span><span class="s1">count == </span><span class="s3">300 </span><span class="s0">or </span><span class="s1">count == </span><span class="s3">3</span><span class="s1">:</span>
        <span class="s1">date1 = datetime.now()</span>
        <span class="s1">add3 = timedelta(days=</span><span class="s3">60</span><span class="s1">)</span>
        <span class="s1">date2 = date1 + add3</span>
        <span class="s1">print(date2)</span>
        <span class="s1">subs = </span><span class="s3">1</span>
        <span class="s1">subs_info = </span><span class="s4">f&quot;</span><span class="s0">{</span><span class="s1">k</span><span class="s0">}</span><span class="s4">=</span><span class="s0">{</span><span class="s1">v</span><span class="s0">}</span><span class="s4">&quot;</span>

        <span class="s1">connect = sqlite3.connect(</span><span class="s4">&quot;Datas.db&quot;</span><span class="s1">)</span>
        <span class="s1">cursor = connect.cursor()</span>
        <span class="s1">user_id = message.from_user.id</span>
        <span class="s1">user_name = message.from_user.username</span>
        <span class="s1">user_firstname = message.from_user.first_name</span>
        <span class="s1">cursor.execute(</span><span class="s4">&quot;&quot;&quot;INSERT OR IGNORE INTO users  
                (tg_users_id, users_name, users_firstname, money_rub, DATE_of_Pay, DATE_of_end_subs, Subs_status, SUBS_INFO)  
            VALUES (?, ?, ?, ?, ?, ?, ?, ?)&quot;&quot;&quot;</span><span class="s0">,</span>
                       <span class="s2"># ? - –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä—ã. –ü—Ä–æ—Å—Ç–æ –∑–∞–Ω–∏–º–∞—é—Ç –º–µ—Å—Ç–æ, –∞ –≤ –Ω–∏—Ö –ª–µ—Ç—è—Ç —Ñ—É–Ω–∫—Ü–∏–∏ f' #—Å—Ç–æ–ª–±—Ü—ã —Ç–∞–±–ª–∏—Ü—ã</span>
                       <span class="s1">(</span><span class="s4">f&quot;</span><span class="s0">{</span><span class="s1">user_id</span><span class="s0">}</span><span class="s4">&quot;</span><span class="s0">, </span><span class="s4">&quot;@&quot; </span><span class="s1">+ </span><span class="s4">f&quot;</span><span class="s0">{</span><span class="s1">user_name</span><span class="s0">}</span><span class="s4">&quot;</span><span class="s0">, </span><span class="s4">f&quot;</span><span class="s0">{</span><span class="s1">user_firstname</span><span class="s0">}</span><span class="s4">&quot;</span><span class="s0">, </span><span class="s4">f&quot;</span><span class="s0">{</span><span class="s1">count</span><span class="s0">}</span><span class="s4">&quot;</span><span class="s0">, </span><span class="s4">f&quot;</span><span class="s0">{</span><span class="s1">date1</span><span class="s0">}</span><span class="s4">&quot;</span><span class="s0">, </span><span class="s4">f&quot;</span><span class="s0">{</span><span class="s1">date2</span><span class="s0">}</span><span class="s4">&quot;</span><span class="s0">, </span><span class="s4">f&quot;</span><span class="s0">{</span><span class="s1">subs</span><span class="s0">}</span><span class="s4">&quot;</span><span class="s0">, </span><span class="s4">f&quot;</span><span class="s0">{</span><span class="s1">subs_info</span><span class="s0">}</span><span class="s4">&quot;</span><span class="s1">))</span>
        <span class="s1">cursor.execute(</span><span class="s4">&quot;&quot;&quot;REPLACE INTO users  
                (tg_users_id, users_name, users_firstname, money_rub, DATE_of_Pay, DATE_of_end_subs, Subs_status, SUBS_INFO)  
            VALUES (?, ?, ?, ?, ?, ?, ?, ?)&quot;&quot;&quot;</span><span class="s0">,</span>
                       <span class="s2"># ? - –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä—ã. –ü—Ä–æ—Å—Ç–æ –∑–∞–Ω–∏–º–∞—é—Ç –º–µ—Å—Ç–æ, –∞ –≤ –Ω–∏—Ö –ª–µ—Ç—è—Ç —Ñ—É–Ω–∫—Ü–∏–∏ f' #—Å—Ç–æ–ª–±—Ü—ã —Ç–∞–±–ª–∏—Ü—ã</span>
                       <span class="s1">(</span><span class="s4">f&quot;</span><span class="s0">{</span><span class="s1">user_id</span><span class="s0">}</span><span class="s4">&quot;</span><span class="s0">, </span><span class="s4">&quot;@&quot; </span><span class="s1">+ </span><span class="s4">f&quot;</span><span class="s0">{</span><span class="s1">user_name</span><span class="s0">}</span><span class="s4">&quot;</span><span class="s0">, </span><span class="s4">f&quot;</span><span class="s0">{</span><span class="s1">user_firstname</span><span class="s0">}</span><span class="s4">&quot;</span><span class="s0">, </span><span class="s4">f&quot;</span><span class="s0">{</span><span class="s1">count</span><span class="s0">}</span><span class="s4">&quot;</span><span class="s0">, </span><span class="s4">f&quot;</span><span class="s0">{</span><span class="s1">date1</span><span class="s0">}</span><span class="s4">&quot;</span><span class="s0">, </span><span class="s4">f&quot;</span><span class="s0">{</span><span class="s1">date2</span><span class="s0">}</span><span class="s4">&quot;</span><span class="s0">, </span><span class="s4">f&quot;</span><span class="s0">{</span><span class="s1">subs</span><span class="s0">}</span><span class="s4">&quot;</span><span class="s0">, </span><span class="s4">f&quot;</span><span class="s0">{</span><span class="s1">subs_info</span><span class="s0">}</span><span class="s4">&quot;</span><span class="s1">))</span>
        <span class="s2"># –∏–º—è —Ñ—É–Ω–∫—Ü–∏–π, –∫–æ—Ç–æ—Ä—ã–µ –¥–∞—é—Ç —Å—é–¥–∞ –∑–Ω–∞—á–µ–Ω–∏—è</span>

        <span class="s1">connect.commit()</span>
        <span class="s1">connect.close()</span>

        <span class="s1">connect.close()</span>
    <span class="s0">elif </span><span class="s1">count == </span><span class="s3">600 </span><span class="s0">or </span><span class="s1">count == </span><span class="s3">6</span><span class="s1">:</span>
        <span class="s1">date1 = datetime.now()</span>
        <span class="s1">add6 = timedelta(days=</span><span class="s3">90</span><span class="s1">)</span>
        <span class="s1">date2 = date1 + add6</span>
        <span class="s1">print(date2)</span>
        <span class="s1">subs = </span><span class="s3">1</span>
        <span class="s1">subs_info = </span><span class="s4">f&quot;</span><span class="s0">{</span><span class="s1">k</span><span class="s0">}</span><span class="s4">=</span><span class="s0">{</span><span class="s1">v</span><span class="s0">}</span><span class="s4">&quot;</span>

        <span class="s1">connect = sqlite3.connect(</span><span class="s4">&quot;Datas.db&quot;</span><span class="s1">)</span>
        <span class="s1">cursor = connect.cursor()</span>
        <span class="s1">user_id = message.from_user.id</span>
        <span class="s1">user_name = message.from_user.username</span>
        <span class="s1">user_firstname = message.from_user.first_name</span>
        <span class="s1">cursor.execute(</span><span class="s4">&quot;&quot;&quot;INSERT OR IGNORE INTO users  
        (tg_users_id, users_name, users_firstname, money_rub, DATE_of_Pay, DATE_of_end_subs, Subs_status, SUBS_INFO)  
    VALUES (?, ?, ?, ?, ?, ?, ?, ?)&quot;&quot;&quot;</span><span class="s0">, </span><span class="s2"># ? - –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä—ã. –ü—Ä–æ—Å—Ç–æ –∑–∞–Ω–∏–º–∞—é—Ç –º–µ—Å—Ç–æ, –∞ –≤ –Ω–∏—Ö –ª–µ—Ç—è—Ç —Ñ—É–Ω–∫—Ü–∏–∏ f' #—Å—Ç–æ–ª–±—Ü—ã —Ç–∞–±–ª–∏—Ü—ã</span>
                   <span class="s1">(</span><span class="s4">f&quot;</span><span class="s0">{</span><span class="s1">user_id</span><span class="s0">}</span><span class="s4">&quot;</span><span class="s0">,</span><span class="s4">&quot;@&quot; </span><span class="s1">+ </span><span class="s4">f&quot;</span><span class="s0">{</span><span class="s1">user_name</span><span class="s0">}</span><span class="s4">&quot;</span><span class="s0">, </span><span class="s4">f&quot;</span><span class="s0">{</span><span class="s1">user_firstname</span><span class="s0">}</span><span class="s4">&quot;</span><span class="s0">, </span><span class="s4">f&quot;</span><span class="s0">{</span><span class="s1">count</span><span class="s0">}</span><span class="s4">&quot;</span><span class="s0">, </span><span class="s4">f&quot;</span><span class="s0">{</span><span class="s1">date1</span><span class="s0">}</span><span class="s4">&quot;</span><span class="s0">, </span><span class="s4">f&quot;</span><span class="s0">{</span><span class="s1">date2</span><span class="s0">}</span><span class="s4">&quot;</span><span class="s0">, </span><span class="s4">f&quot;</span><span class="s0">{</span><span class="s1">subs</span><span class="s0">}</span><span class="s4">&quot;</span><span class="s0">, </span><span class="s4">f&quot;</span><span class="s0">{</span><span class="s1">subs_info</span><span class="s0">}</span><span class="s4">&quot;</span><span class="s1">))</span>
        <span class="s1">cursor.execute(</span><span class="s4">&quot;&quot;&quot;REPLACE INTO users  
        (tg_users_id, users_name, users_firstname, money_rub, DATE_of_Pay, DATE_of_end_subs, Subs_status, SUBS_INFO)  
    VALUES (?, ?, ?, ?, ?, ?, ?, ?)&quot;&quot;&quot;</span><span class="s0">,  </span><span class="s2"># ? - –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä—ã. –ü—Ä–æ—Å—Ç–æ –∑–∞–Ω–∏–º–∞—é—Ç –º–µ—Å—Ç–æ, –∞ –≤ –Ω–∏—Ö –ª–µ—Ç—è—Ç —Ñ—É–Ω–∫—Ü–∏–∏ f' #—Å—Ç–æ–ª–±—Ü—ã —Ç–∞–±–ª–∏—Ü—ã</span>
                   <span class="s1">(</span><span class="s4">f&quot;</span><span class="s0">{</span><span class="s1">user_id</span><span class="s0">}</span><span class="s4">&quot;</span><span class="s0">,</span><span class="s4">&quot;@&quot; </span><span class="s1">+ </span><span class="s4">f&quot;</span><span class="s0">{</span><span class="s1">user_name</span><span class="s0">}</span><span class="s4">&quot;</span><span class="s0">, </span><span class="s4">f&quot;</span><span class="s0">{</span><span class="s1">user_firstname</span><span class="s0">}</span><span class="s4">&quot;</span><span class="s0">, </span><span class="s4">f&quot;</span><span class="s0">{</span><span class="s1">count</span><span class="s0">}</span><span class="s4">&quot;</span><span class="s0">, </span><span class="s4">f&quot;</span><span class="s0">{</span><span class="s1">date1</span><span class="s0">}</span><span class="s4">&quot;</span><span class="s0">, </span><span class="s4">f&quot;</span><span class="s0">{</span><span class="s1">date2</span><span class="s0">}</span><span class="s4">&quot;</span><span class="s0">, </span><span class="s4">f&quot;</span><span class="s0">{</span><span class="s1">subs</span><span class="s0">}</span><span class="s4">&quot;</span><span class="s0">, </span><span class="s4">f&quot;</span><span class="s0">{</span><span class="s1">subs_info</span><span class="s0">}</span><span class="s4">&quot;</span><span class="s1">))</span>
      <span class="s2"># –∏–º—è —Ñ—É–Ω–∫—Ü–∏–π, –∫–æ—Ç–æ—Ä—ã–µ –¥–∞—é—Ç —Å—é–¥–∞ –∑–Ω–∞—á–µ–Ω–∏—è</span>

        <span class="s1">connect.commit()</span>
        <span class="s1">connect.close()</span>



<span class="s0">async def </span><span class="s1">mai():</span>
    <span class="s1">task1 = asyncio.create_task(kr())</span>
    <span class="s1">task2 = asyncio.create_task(kr1())</span>
    <span class="s1">task3 = asyncio.create_task(kr2())</span>
    <span class="s1">task4 = asyncio.create_task(successful_payment())</span>
    <span class="s1">task5 = asyncio.create_task(pre_checkout_query())</span>
    <span class="s1">task6 = asyncio.create_task(answe())</span>
    <span class="s1">task7 = asyncio.create_task(cmd_handler())</span>
    <span class="s1">task8 = asyncio.create_task(join_chat_members())</span>
    <span class="s1">task9 = asyncio.create_task(pre_checkout_query())</span>

    <span class="s0">await </span><span class="s1">task1</span>
    <span class="s0">await </span><span class="s1">task2</span>
    <span class="s0">await </span><span class="s1">task3</span>
    <span class="s0">await </span><span class="s1">task4</span>
    <span class="s0">await </span><span class="s1">task5</span>
    <span class="s0">await </span><span class="s1">task6</span>
    <span class="s0">await </span><span class="s1">task7</span>
    <span class="s0">await </span><span class="s1">task8</span>
    <span class="s0">await </span><span class="s1">task9</span>

<span class="s1">asyncio.run(mai())</span>

<span class="s2"># run long-polling</span>
<span class="s0">if </span><span class="s1">__name__ == </span><span class="s4">&quot;__main__&quot;</span><span class="s1">:</span>
    <span class="s1">executor.start_polling(dp</span><span class="s0">, </span><span class="s1">skip_updates=</span><span class="s0">False</span><span class="s1">)</span>

</pre>
</body>
</html>